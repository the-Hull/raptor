xmin<- interest[,"XCAL"]-length*search_width_earlywood
xmax<- interest[,"XCAL"]+length*search_width_earlywood
ymin<- interest[,"YCAL"]+(length/2)
ymax<- interest[,"YCAL"]+length*search_length_earlywood
x<-c(xmin,xmin,xmax,xmax)
y<-c(ymin,ymax,ymax,ymin)
if(make.plot==TRUE){polygon(x,y,lty=2,border="orange")}
selected_cells<-data_year[which(data_year[,"XCAL"]>=xmin & data_year[,"XCAL"]<=xmax & data_year[,"YCAL"]>=ymin & data_year[,"YCAL"]<=ymax),]
if(nrow(selected_cells)==0){
data_year[which(data_year[,"ROW"]==c & data_year[,"POSITION"]==k),"MARKER"]<-1
MARK1<-data_year[which(data_year$MARKER==1),]
if(make.plot==TRUE){
points(MARK1$XCAL,MARK1$YCAL, pch=16, col="orange",cex=1.3)
points(MARK1$XCAL,MARK1$YCAL, pch=1, col="black",cex=1.3)
}
break
}else{
selected_cells[,"LENGTH"]<-NA
ax<-interest[,"XCAL"]
ay<-interest[,"YCAL"]
cut_off_size<-interest[,"CA"]/earlywood_cutoff
selected_cells<-selected_cells[which(selected_cells[,"CA"]>=cut_off_size),]
if(nrow(selected_cells)==0){
if(is.na(data_year[which(data_year[,"ROW"]==c & data_year[,"POSITION"]==k),"MARKER"])) {
data_year[which(data_year[,"ROW"]==c & data_year[,"POSITION"]==k),"MARKER"]<-2
MARK2<-data_year[which(data_year$MARKER==2),]
if(make.plot==TRUE){
points(MARK2$XCAL,MARK2$YCAL, pch=16, col="orange",cex=1.3)
points(MARK2$XCAL,MARK2$YCAL, pch=1, col="black",cex=1.3)
}
}
break
}else{
for (z in c(1:nrow(selected_cells))){
#z<-2
bx<-selected_cells[z,"XCAL"]
by<-selected_cells[z,"YCAL"]
selected_cells[z,"LENGTH"]<-(sqrt(2*((sqrt((bx-ax)^2)))^2+(sqrt((by-ay)^2))^2))
}
size<-interest[1,"CA"]
selected_cells                <-selected_cells[which(selected_cells[,"CA"]>(size/3)),]
selected_cells                <-selected_cells[which(is.na(selected_cells[,"ROW"])==TRUE),]
CID_new<-selected_cells[order(selected_cells$LENGTH),]
CID_new<-CID_new[1,"CID"]
data_year[which(data_year[,"CID"]==CID_new),"POSITION"]<-k+1
data_year[which(data_year[,"CID"]==CID_new),"ROW"]     <-c
data_one<-data_year[which(data_year[,"CID"]==CID_new),]
length<-data_one[1,"SQRLENGTH"]/2
x     <-data_one[1,"XCAL"]
y     <-data_one[1,"YCAL"]
x_cor<-c((x-length/1),(x+length/1),(x+length/1),(x-length/1))
y_cor<-c((y+length*1),(y+length*1),(y-length*1),(y-length*1))
}
}
}
}
backup<-data_year
data_year<-backup
#ROW IDENTIFICATION LATEWOOD----
for (r in c(1:max(data_year[,"ROW"],na.rm=TRUE))){
data_select<-data_year[which(data_year[,"ROW"]==r),]
max_width  <-max(data_select[,"SQRLENGTH"],na.rm=TRUE)
mean_length<-mean(data_select[,"SQRLENGTH"],na.rm=TRUE)
last_ID    <-data_select[which(data_select[,"POSITION"]==max(data_select[,"POSITION"],na.rm=TRUE)),]
for (g in c(1:nrow(data_year))){
run          <-last_ID[,"POSITION"]+g-1
data_select  <-data_year[which(data_year[,"ROW"]==r),]
data_interest<-data_select[which(data_select[,"POSITION"]==run),]
min_length   <-data_interest[,"SQRLENGTH"]
xmin         <-data_interest[,"XCAL"]-mean_length*search_width_latewood
xmax         <-data_interest[,"XCAL"]+mean_length*search_width_latewood
ymin         <-data_interest[,"YCAL"]+(min_length/2)
ymax         <-data_interest[,"YCAL"]+mean_length*search_length_latewood
x<-c(xmin,xmin,xmax,xmax)
y<-c(ymin,ymax,ymax,ymin)
if(make.plot==TRUE){polygon(x,y,lty=2,border="red")}
selected_cells<-data_year[which(data_year[,"XCAL"]>=xmin & data_year[,"XCAL"]<=xmax & data_year[,"YCAL"]>=ymin & data_year[,"YCAL"]<=ymax),]
if(nrow(selected_cells)==0){
data_year[which(data_year[,"POSITION"]==run & data_year[,"ROW"]==r ),"MARKER"]<-3
MARK3<-data_year[which(data_year$MARKER==3),]
if(make.plot==TRUE){
points(MARK3$XCAL,MARK3$YCAL, pch=16, col="red",cex=1.3)
points(MARK3$XCAL,MARK3$YCAL, pch=1, col="black",cex=1.3)
}
break
}else{
selected_cells[,"LENGTH"]<-NA
ax         <-data_interest[,"XCAL"]
ay         <-data_interest[,"YCAL"]
#here we exclude cells that are 3 times smaller than the original ones
cut_off_size<-data_interest[,"CA"]/latewood_cutoff
selected_cells<-selected_cells[which(selected_cells[,"CA"]>=cut_off_size),]
if(nrow(selected_cells)==0){
data_year[which(data_year[,"POSITION"]==run & data_year[,"ROW"]==r ),"MARKER"]<-4
MARK4<-data_year[which(data_year$MARKER==4),]
if(make.plot==TRUE){
points(MARK4$XCAL,MARK4$YCAL, pch=16, col="red",cex=1.3)
points(MARK4$XCAL,MARK4$YCAL, pch=1, col="black",cex=1.3)
}
break
}else{
for (z in c(1:nrow(selected_cells))){
bx<-selected_cells[z,"XCAL"]
by<-selected_cells[z,"YCAL"]
selected_cells[z,"LENGTH"]<-(sqrt(5*((sqrt((bx-ax)^2)))^2+(sqrt((by-ay)^2))^2))
}
selected_cells                <-selected_cells[which(is.na(selected_cells[,"ROW"])==TRUE),]
CID_new<-selected_cells[order(selected_cells$LENGTH),]
CID_new<-CID_new[1,"CID"]
data_year[which(data_year[,"CID"]==CID_new),"POSITION"]<-last_ID[,"POSITION"]+g
data_year[which(data_year[,"CID"]==CID_new),"ROW"]     <-r
data_one<-data_year[which(data_year[,"CID"]==CID_new),]
length<-data_one[1,"SQRLENGTH"]/2
x     <-data_one[1,"XCAL"]
y     <-data_one[1,"YCAL"]
x_cor<-c((x-length/1),(x+length/1),(x+length/1),(x-length/1))
y_cor<-c((y+length*1),(y+length*1),(y-length*1),(y-length*1))
}
}
}
}
backup<-data_year
data_year<-backup
list.of.packages <- c("mgcv","gam","base")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
require("gam")
require("mgcv")
require("base")
#FINAL GAMM FIT FOR THE CELL POSITION (WITH PADDING OF 0.5 micron)----
#error.test <- try(gam(y ~ s(x),data=input_m),silent =TRUE)
#if("try-error" %in% class(error.test)){print("no gam applied due to low number of rows")
#  data_years <-data_year[which(is.na(data_year[,"ROW"])==FALSE),]
#  data_years <-data_years[order(data_years$XCAL),]
for (r in c(1:max(data_year[,"ROW"],na.rm=TRUE))){
data_select<-data_year[which(data_year[,"ROW"]==r),]
if(length(data_select[,"POSITION"])<=3){
next
}else{
x                      <-data_select[,"XCAL"]
y                      <-data_select[,"YCAL"]
x_new                  <-(c(x,x,x))#padding the cells
y_new                  <-(c(y,(y-0.5),(y+0.5)))#padding the cells
input_m                  <-data.frame(cbind(y_new,x_new))
colnames(input_m)        <-c("y","x")
Model                  <-gam(x ~ s(y),data=input_m)
y                      <-c(min(data_select[,"YCAL"],na.rm=TRUE):max(data_select[,"YCAL"],na.rm=TRUE))
predict                <-predict(Model,newdata=data.frame(y))
mean_width             <-mean(data_select[,"SQRLENGTH"],na.rm=TRUE)
#if(make.plot==TRUE){#lines((predict),y,lty=1)
#  lines((as.numeric(predict)+mean_width*gam_width),y,lty=2)
#  lines((as.numeric(predict)-mean_width*gam_width),y,lty=2)
#}
data_na                <-data_year[which(is.na(data_year[,"ROW"])==TRUE),]
y                      <-data_na[,"YCAL"]
value                  <-predict(Model,newdata=data.frame(y))
upper                  <-value+mean_width*gam_width
lower                  <-value-mean_width*gam_width
selection_cells        <-cbind(data_na[,"CID"],data_na[,"XCAL"],upper,lower)
selection_CID          <-selection_cells[which(selection_cells[,2]>=selection_cells[,"lower"] & selection_cells[,2]<=selection_cells[,"upper"]),1]
data_year[which(data_year[,"CID"]%in% selection_CID),"ROW"]<-r
}
}
backup<-data_year
data_year<-backup
#mistake when little rows are present
row_code<-sort(unique(data_year[,"ROW",]))
for(j in c(1:length(row_code))){
#j<-1
selected_data                  <-data_year[which(data_year[,"ROW"]==row_code[j]),]
selected_data                  <-selected_data[order(selected_data$YCAL),]
selected_data[,"DISTANCE"]     <-NA
for(k in c(1:nrow(selected_data))){
one<-selected_data[k,]
two<-selected_data[(k+1),]
#if(nrow(two)==0){
if(is.na(two$CID)){
data_year[which(data_year$CID==one$CID),"MARKER"]<-5
MARK5<-data_year[which(data_year$MARKER==5),]
if(make.plot==TRUE){
points(MARK5$XCAL,MARK5$YCAL, pch=15, col="red",cex=1.3)
points(MARK5$XCAL,MARK5$YCAL, pch=0, col="black",cex=1.3)
}
break
}else{
selected_data[k+1,"DISTANCE"]<-sqrt(((sqrt((one[,"XCAL"]-two[,"XCAL"])^2))^2)+((sqrt((one[,"YCAL"]-two[,"YCAL"])^2))^2))
}
selected_data[1,"DISTANCE"] <-0
}
selected_data[,"TIMES"]<-NA
for(k in c(2:nrow(selected_data))){
#k<-2
one<-selected_data[k,"DISTANCE"]
two<-selected_data[(k+1),"DISTANCE"]
if(length(two)==0){
break
}else{
selected_data[k,"TIMES"]<- two/one
}
}
if(suppressWarnings(max(selected_data[,"TIMES"],na.rm=TRUE))=="-Inf"){
data_year[which(data_year[,"ROW"]==row_code[j]),"ROW"]<-NA
}else{
if(max(selected_data[,"TIMES"],na.rm=TRUE)>profile_cutoff){
data_year[which(data_year[,"ROW"]==row_code[j]),"MARKER"]<-6
MARK6<-data_year[which(data_year$MARKER==6),]
if(make.plot==TRUE){
points(MARK6$XCAL,MARK6$YCAL, pch=3, col="black",cex=0.8)
}
data_year[which(data_year[,"ROW"]==row_code[j]),"ROW"]<-NA
}else{
data_year[which(data_year[,"ROW"]==row_code[j]),"ROW"]<-row_code[j]
}
}
}
backup<-data_year
data_year<-backup
#ROWS WITH LESS THEN 0.60 PERCENTAGE OF THE TOTAL AMOUNT OF CELLS SHOULD BE EXCLUDED-----
row_code<-sort(unique(data_year[,"ROW",]))
if(length(row_code)==0){
data_year[,"POSITION"]<-NA
}else{
cut_off<-max(data_year[,"POSITION"],na.rm=TRUE)*percentage_max_nr_cells
for (r in c(1:length(row_code))){
selected_data<-data_year[which(data_year[,"ROW"]==row_code[r]),]
if(nrow(selected_data)<cut_off){
data_year[which(data_year[,"ROW"]==row_code[r]),"MARKER"]<-7
MARK7<-data_year[which(data_year$MARKER==7),]
if(make.plot==TRUE){
points(MARK7$XCAL,MARK7$YCAL, pch=4, col="black",cex=0.8)
}
data_year[which(data_year[,"ROW"]==row_code[r]),"ROW"]<-NA
}else{
data_year[which(data_year[,"ROW"]==row_code[r]),"ROW"]<-row_code[r]
}
}}
#ALL CELLS AND ROWS ARE RENUMBERED FOR THE FINAL OUTPUT----
data_year[,"POSITION"]<-NA
row_code<-sort(unique(data_year[,"ROW",]))
if(length(row_code)!=0){
for (r in c(1:length(row_code))){
isolated_data<-data_year[which(data_year[,"ROW"]==row_code[r]),]
CID<-isolated_data[order(isolated_data$YCAL),"CID"]
data_year[which(data_year[,"CID"]%in%CID),"ROW"]<-r
data_year[which(data_year[,"CID"]%in%CID),"POSITION"]<-c(1:nrow(isolated_data))
}}
if(make.plot==TRUE){
for(q in c(1:nrow(data_year))){
text(data_year[q,"XCAL"],data_year[q,"YCAL"],data_year[q,"POSITION"],cex=0.5,col="black")}}
if(nrow(data_year[which(data_year[,"MARKER"]==1|data_year[,"MARKER"]==2),])!=0){
data_year[which(data_year[,"MARKER"]==1|data_year[,"MARKER"]==2),"MARKER"]<-1}
if(nrow(data_year[which(data_year[,"MARKER"]==3|data_year[,"MARKER"]==4),])!=0){
data_year[which(data_year[,"MARKER"]==3|data_year[,"MARKER"]==4),"MARKER"]<-2}
if(nrow(data_year[which(data_year[,"MARKER"]==5),])!=0){
data_year[which(data_year[,"MARKER"]==5),"MARKER"]<-3}
if(nrow(data_year[which(data_year[,"MARKER"]==6),])!=0){
data_year[which(data_year[,"MARKER"]==6),"MARKER"]<-4}
if(nrow(data_year[which(data_year[,"MARKER"]==7),])!=0){
data_year[which(data_year[,"MARKER"]==7),"MARKER"]<-5}
if(u==1){output<-data_year}else{output<-rbind(output,data_year)}
}
col_nr<-ncol(output)
weird<-which(colnames(output)=="SQRLENGTH")
output<-output[,c(-weird)]
return(output)
}
#7.write.output----
write.output<-function(input,location=c("D:\\Documents"),flip=FALSE){
#input<-output
if(missing(flip)){flip<-FALSE}
if(flip!=TRUE&flip!=FALSE)stop('flip need to be TRUE/FALSE')
if(missing(location)){location<-FALSE}
sample<-unique(input[,"ID"])
if(location!=FALSE){
setwd(location)
pdf(file=paste(sample,".pdf",sep=""),height=210/25.4,width=297/25.4,paper="A4r")}
years<-unique(input[,"YEAR"])
for(u in c(1:length(years)) ){
#u<-1
data_year<-input[which(input[,"YEAR"]==years[u]),]
year<-years[u]
if(flip==FALSE){
plot(data_year[,"XCAL"],data_year[,"YCAL"],ylab="Rel. Y-coordinates (micron)",
ylim=c(0-max(data_year[,"YCAL"],na.rm=TRUE)*0.01,max(data_year[,"YCAL"],na.rm=TRUE)),
main=paste(sample," - ",as.character(year)," - Rows: ",max(data_year[,"ROW"],na.rm=TRUE),sep=""),xlab="Rel. X-coordinates (micron)",pch=16,cex=0.2,col="white")}
if(flip==TRUE){
plot(data_year[,"XCAL"],data_year[,"YCAL"],ylab="Rel. Y-coordinates (micron)",
ylim=c(max(data_year[,"YCAL"],na.rm=TRUE),0-max(data_year[,"YCAL"],na.rm=TRUE)*0.01),
main=paste(sample," - ",as.character(year)," - Rows: ",max(data_year[,"ROW"],na.rm=TRUE),sep=""),xlab="Rel. X-coordinates (micron)",pch=16,cex=0.2,col="white")
}
data_year[,"SQRLENGTH"] <-sqrt(data_year[,"CA"])
nrcells<-nrow(data_year)
rows<-max(unique(data_year[,"ROW"])[which(is.na(unique(data_year[,"ROW"]))==FALSE)])
#col_code<-rep(c("orange","blue","red","green","purple"),ceiling(rows/5))
#col_code<-rep(c("#FFA500 ","#FF3300","#C71585","#191970 ","#20B2AA ","#00CC33","#006633"),ceiling(rows/7))
col_code<-rep(c("#FFA500","#FF3300","#C71585","#191970","#20B2AA","#00CC33","#006633"),ceiling(rows/7))
for(i in c(1:nrcells)){
length<-data_year[i,"SQRLENGTH"]/2
x     <-data_year[i,"XCAL"]
y     <-data_year[i,"YCAL"]
x_cor<-c((x-length),(x+length),(x+length),(x-length))
y_cor<-c((y+length),(y+length),(y-length),(y-length))
if(is.na(data_year[i,"ROW"])==TRUE){
polygon(x_cor,y_cor)
}else{
polygon(x_cor,y_cor,col=col_code[data_year[i,"ROW"]])
}
if(is.na(data_year[i,"ROW"])==FALSE){
label_point<-data_year[i,"POSITION"]
text(x,y,label=label_point,col='black',cex=0.5)
}else{
next
}
}
first_cells<-data_year[which(data_year[,"POSITION"]==1),]
for(i in c(1:nrow(first_cells))){
x<-first_cells[i,"XCAL"]
y<-first_cells[i,"YCAL"]
length<-first_cells[i,"SQRLENGTH"]/1.2
label_point<-first_cells[i,"ROW"]
text(x,y-length,label=label_point,col='black',cex=0.8,font=2)
}
a<-which(colnames(data_year)=="SQRLENGTH")
data_year<-data_year[,-a]
name<-paste(sample,"-",as.character(year),sep="")
assign(name,data_year)
}
if(length(years)==1){
output_all_years<-get(paste(sample,"-",as.character(years[1]),sep=""))
}else{
output_all_years<-get(paste(sample,"-",as.character(years[1]),sep=""))
for(t in c(2:(length(years)))){
output_all_years<-rbind(output_all_years,get(paste(sample,"-",as.character(years[t]),sep="")))
}
}
if(location!=FALSE){
write.table(output_all_years,file=paste(sample,"_output.txt",sep=""),row.names=FALSE,sep="\t")
dev.off()}
return(output_all_years)
}
#8.batch.mode----
batch.mode<-function(location=c("..."),files=FALSE,interact=TRUE,make.plot=TRUE,aligning=TRUE,frac.small=0.5,swe=0.5,sle=3,
ec=3,swl=0.5,sll=5,lc=10,prof.co=6,max.cells=0.5,list=FALSE,flip=FALSE){
#test
#location = c("D:\\Documents\\WSL\\07_work_documents\\2_results_excel\\Chapter 2 - Anatomical analysis\\RAPTOR\\Test-Georg")
#files = c("17_3_15_A_a_Output_Cells.txt")
#swe = 0.5
#sle = 3
#ec = 1.75
#swl = 0.25
#sll = 5
#lc = 5
#frac.small<-0.5
#prof.co =  6
#max.cells = 0.5
#aligning = TRUE
#interact<-FALSE
#make.plot<-TRUE
#list<-FALSE
###
if(missing(flip)){flip<-FALSE}
if(flip!=TRUE&flip!=FALSE)stop('flip need to be TRUE/FALSE')
if(missing(interact)){interact<-FALSE}
if(missing(make.plot)){make.plot<-TRUE}
if(missing(frac.small)){frac.small<-0.5}
if(missing(aligning)){aligning<-TRUE}
if(missing(swe)){swe<-0.5}
if(missing(sle)){sle<-3}
if(missing(ec)){ec<-3}
if(missing(swl)){swl<-0.5}
if(missing(sll)){sle<-5}
if(missing(lc)){ec<-10}
if(missing(prof.co)){prof.co<-6}
if(missing(max.cells)){max.cells<-0.5}
if(missing(list)){list<-FALSE}
setwd(location)
if(missing(files)){
left                <- function(string, char){
substr(string, 1,char)}
right               <- function (string, char){
substr(string,nchar(string)-(char-1),nchar(string))
}
files<-list.files(path = location)[which(right(list.files(path = location),3)=="txt")]
}else{
for(h in c(1:length(files))){
if(length(which(list.files(path = location)==files[h]))==0)stop(paste(files[h],' is not present in setwd()',sep=""))
}
}
a.<-interact
b.<-make.plot
c.<-list
d.<-frac.small
e.<-aligning
f.<-swe
g.<-sle
h.<-ec
i.<-swl
j.<-sll
k.<-lc
l.<-prof.co
m.<-max.cells
for(file in c(1:length(files))){
file<-1
interact<-a.
a.<-interact
make.plot<-b.
b.<-make.plot
list<-c.
c.<-list
frac.small<-d.
d.<-frac.small
aligning<-e.
e.<-aligning
swe<-f.
f.<-swe
sle<-g.
g.<-sle
ec<-h.
h.<-ec
swl<-i.
i.<-swl
sll<-j.
j.<-sll
lc<-k.
k.<-lc
prof.co<-l.
l.<-prof.co
max.cells<-m.
m.<-max.cells
input<-is.raptor(read.table(files[file],header=TRUE,sep="\t"))
if(a.==TRUE){c.<-FALSE}
if(missing(list)){c.<-FALSE}
if(interact==FALSE & list!=FALSE){
c.<-list[which(list[,1]==unique(input[,"ID"])),2]}
sample<-unique(input[,"ID"])
if(b.==TRUE&a.==FALSE){pdf(file=paste(sample,".pdf",sep=""),height=210/25.4,width=297/25.4,paper="A4r")}
output1<-align(input,interact=a.,make.plot=b.,list=c.,year=FALSE)
if(b.==TRUE&a.==TRUE){pdf(file=paste(sample,".pdf",sep=""),height=210/25.4,width=297/25.4,paper="A4r")}
output2<-first.cell(output1, frac.small = d., yrs = FALSE, make.plot = b.)
output3<-pos.det(output2, swe = f., sle = g., ec = h., swl = i., sll = j., lc = k.,
prof.co = l., max.cells = m., yrs = FALSE , aligning = e. , make.plot = b.)
years<-unique(output3[,"YEAR"])
for(u in c(1:length(years)) ){
data_year<-output3[which(output3[,"YEAR"]==years[u]),]
year<-years[u]
if(b.==TRUE){
if(flip==FALSE){
plot(data_year[,"XCAL"],data_year[,"YCAL"],ylab="Rel. Y-coordinates (micron)",
ylim=c(0-max(data_year[,"YCAL"],na.rm=TRUE)*0.01,max(data_year[,"YCAL"],na.rm=TRUE)),
main=paste(sample," - ",as.character(year)," - Rows: ",max(data_year[,"ROW"],na.rm=TRUE),sep=""),xlab="Rel. X-coordinates (micron)",pch=16,cex=0.2,col="white")}
if(flip==TRUE){
plot(data_year[,"XCAL"],data_year[,"YCAL"],ylab="Rel. Y-coordinates (micron)",
ylim=c(max(data_year[,"YCAL"],na.rm=TRUE),0-max(data_year[,"YCAL"],na.rm=TRUE)*0.01),
main=paste(sample," - ",as.character(year)," - Rows: ",max(data_year[,"ROW"],na.rm=TRUE),sep=""),xlab="Rel. X-coordinates (micron)",pch=16,cex=0.2,col="white")
}
}
data_year[,"SQRLENGTH"] <-sqrt(data_year[,"CA"])
nrcells<-nrow(data_year)
rows<-max(unique(data_year[,"ROW"])[which(is.na(unique(data_year[,"ROW"]))==FALSE)])
#col_code<-rep(c("orange","blue","red","green","purple"),ceiling(rows/5))
#col_code<-rep(c("#FFA500 ","#FF3300","#C71585","#191970 ","#20B2AA ","#00CC33","#006633"),ceiling(rows/7))
col_code<-rep(c("#FFA500","#FF3300","#C71585","#191970","#20B2AA","#00CC33","#006633"),ceiling(rows/7))
for(i in c(1:nrcells)){
length<-data_year[i,"SQRLENGTH"]/2
x     <-data_year[i,"XCAL"]
y     <-data_year[i,"YCAL"]
x_cor<-c((x-length),(x+length),(x+length),(x-length))
y_cor<-c((y+length),(y+length),(y-length),(y-length))
if(b.==TRUE){
if(is.na(data_year[i,"ROW"])==TRUE){
polygon(x_cor,y_cor)
}else{
polygon(x_cor,y_cor,col=col_code[data_year[i,"ROW"]])
}
if(is.na(data_year[i,"ROW"])==FALSE){
label_point<-data_year[i,"POSITION"]
text(x,y,label=label_point,col='black',cex=0.5)
}else{
next
}
}
}
first_cells<-data_year[which(data_year[,"POSITION"]==1),]
for(i in c(1:nrow(first_cells))){
x<-first_cells[i,"XCAL"]
y<-first_cells[i,"YCAL"]
length<-first_cells[i,"SQRLENGTH"]/1.2
label_point<-first_cells[i,"ROW"]
if(b.==TRUE){
text(x,y-length,label=label_point,col='black',cex=0.8,font=2)}
}
a<-which(colnames(data_year)=="SQRLENGTH")
data_year<-data_year[,-a]
name<-paste(sample,"-",as.character(year),sep="")
assign(name,data_year)
}
if(length(years)==1){
output_all_years<-get(paste(sample,"-",as.character(years[1]),sep=""))
}else{
output_all_years<-get(paste(sample,"-",as.character(years[1]),sep=""))
for(t in c(2:(length(years)-1))){
output_all_years<-rbind(output_all_years,get(paste(sample,"-",as.character(years[t]),sep="")))
}
}
if(is.character(location)==TRUE){
write.table(output_all_years,file=paste(sample,"_output.txt",sep=""),row.names=FALSE,sep="\t")
if(b.==TRUE){dev.off()}
}
}
}
input<-example.data(species="LOT_PICEA")
source('C:/Users/ahurl/OneDrive/DOC/PhD/author/raptor/all.examples.R')
