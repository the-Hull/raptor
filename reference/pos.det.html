<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Determining the cell position — pos.det • RAPTOR</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Determining the cell position — pos.det" />
<meta property="og:description" content="Returns a data.frame, similar as produced by first.cell, but with added columns providing ROW and POSITION which indicate the radial files number (ROW, from left to right) and radial cell position (from earlywood to latewood) of each tracheid. NA is assigned to cells not belonging to recognized radial files. A MARKER column is added to indicate the last detected cell in the earlywood search (indicated with 1), latewood search (2), the last detected cell (3), rows that are removed due to gaps (4, see prof.co) and rows that are removed due to limited amount of cells (5, see max.cells)." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RAPTOR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/the-hull/RAPTOR/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Determining the cell position</h1>
    <small class="dont-index">Source: <a href='https://github.com/the-hull/RAPTOR/blob/master/R/pos.det.R'><code>R/pos.det.R</code></a></small>
    <div class="hidden name"><code>pos.det.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Returns a <code><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></code>, similar as produced by <code><a href='first.cell.html'>first.cell</a></code>, but with added columns providing ROW and POSITION which indicate the radial files number (ROW, from left to right) and radial cell position (from earlywood to latewood) of each tracheid. <code><a href='https://rdrr.io/r/base/NA.html'>NA</a></code> is assigned to cells not belonging to recognized radial files. A MARKER column is added to indicate the last detected cell in the earlywood search (indicated with 1), latewood search (2), the last detected cell (3), rows that are removed due to gaps (4, see prof.co) and rows that are removed due to limited amount of cells (5, see max.cells).</p>
    </div>

    <pre class="usage"><span class='fu'>pos.det</span>(<span class='no'>input</span>, <span class='kw'>swe</span> <span class='kw'>=</span> <span class='fl'>0.5</span>, <span class='kw'>sle</span> <span class='kw'>=</span> <span class='fl'>3</span>, <span class='kw'>ec</span> <span class='kw'>=</span> <span class='fl'>1.75</span> , <span class='kw'>swl</span> <span class='kw'>=</span> <span class='fl'>0.25</span>, <span class='kw'>sll</span> <span class='kw'>=</span> <span class='fl'>5</span>, <span class='kw'>lc</span> <span class='kw'>=</span> <span class='fl'>5</span>,
        <span class='kw'>prof.co</span> <span class='kw'>=</span> <span class='fl'>6</span>, <span class='kw'>max.cells</span> <span class='kw'>=</span> <span class='fl'>0.5</span>, <span class='kw'>list</span><span class='kw'>=</span><span class='fl'>FALSE</span>, <span class='kw'>yrs</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
        <span class='kw'>aligning</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>make.plot</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>input</th>
      <td><p>an input file as produced by <code><a href='first.cell.html'>first.cell</a></code>.</p></td>
    </tr>
    <tr>
      <th>swe</th>
      <td><p>a numeric value that is multiplied by the square-rooted cell lumen area (l) of the target cell and used to determine the width of the rectangular search area which locates the next earlywood cell in the row (default = 0.5).</p></td>
    </tr>
    <tr>
      <th>sle</th>
      <td><p>a numeric value that is multiplied by the square rooted cell lumen area (l) of the target cell to determine the length of the rectangle search area which locates the next earlywood cell in the row (default = 3).</p></td>
    </tr>
    <tr>
      <th>ec</th>
      <td><p>threshold ratio between the lumen area of two consecutive earlywood cells to determine the end of the earlywood search (default = 1.75). The default setting indicates that the earlywood search ends when the next cell lumen area is at least 1.75 times smaller than the target cell.</p></td>
    </tr>
    <tr>
      <th>swl</th>
      <td><p>a numeric value that is multiplied by the square rooted cell lumen area (l) of the target cell to determine the width of the rectangle search area which locates the next latewood cell in the row (default = 0.25).</p></td>
    </tr>
    <tr>
      <th>sll</th>
      <td><p>a numeric value that is multiplied by the square rooted cell lumen area (l) of the target cell to determine the length of the rectangle search area which locates the next earlywood cell in the row (default = 5).</p></td>
    </tr>
    <tr>
      <th>lc</th>
      <td><p>threshold ratio between the lumen area of two consecutive latewood cells to determine the end of the radial file (default = 10). The default setting indicates that the latewood search ends when the next cell lumen area is at least 10 times smaller than the target cell.</p></td>
    </tr>
    <tr>
      <th>prof.co</th>
      <td><p>threshold ratio between the distance to the previous and consecutive cell to determine if the row (or radial file) should be excluded (default = 6).</p></td>
    </tr>
    <tr>
      <th>max.cells</th>
      <td><p>threshold proportion of the maximum number of cells to determine if the radial file has to be excluded (default = 0.6).</p></td>
    </tr>
    <tr>
      <th>list</th>
      <td><p>a <code><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></code> of "CID" (unique cell ID) from cells which should be considered as first row cells. Should be filled if <code><a href='first.cell.html'>first.cell</a></code> output is not used as input. The vector should be ordered to years and present specific "CID" which is considered the first cell.</p></td>
    </tr>
    <tr>
      <th>yrs</th>
      <td><p>either a vector providing the year(s) of interest or <code><a href='https://rdrr.io/r/base/logical.html'>FALSE</a></code> to select all years included in the input file (default = <code><a href='https://rdrr.io/r/base/logical.html'>FALSE</a></code>).</p></td>
    </tr>
    <tr>
      <th>aligning</th>
      <td><p>logical flag indicating whether a second alignment has to be performed based upon the cells detected within <code><a href='first.cell.html'>first.cell</a></code> (default = <code><a href='https://rdrr.io/r/base/logical.html'>TRUE</a></code>).</p></td>
    </tr>
    <tr>
      <th>make.plot</th>
      <td><p>logical flag indicating whether to make a plot (default =  <code><a href='https://rdrr.io/r/base/logical.html'>FALSE</a></code>).</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An <code><a href='is.raptor.html'>is.raptor</a></code> file with an added column describing the position within the radial file.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>After the identification of the first cells (with <code><a href='first.cell.html'>first.cell</a></code>) within a radial file, this function assigns remaining cells to a corresponding radial file based on various search criteria. A local search algorithm is applied which searches cells above a specified target cell (n; starts with first cell of the radial file detected by <code><a href='first.cell.html'>first.cell</a></code>). First the "earlywood" search process projects a search area from the selected cell with a specific width (x-axis) and length (y-axis). The search length and width is based on the length of the target cell (l_n) determined with size of the cell (where l_n= <code><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></code>(CA_n) ) and multiplied by a factor (sle = search length earlywood, for the search length and swe = search width earlywood, for the search width). This initial search grid is presented in "orange"(if make.plot = <code><a href='https://rdrr.io/r/base/logical.html'>TRUE</a></code>), where the width can be adjusted by changing swe and the length by sle. When no cells are detected (last detected cells are indicated with orange circles), caused in most cases by the small size of latewood cells, a second search grid is established with an altered length and width (sll = search length latewood and swl = search width latewood; presented in "red" if make.plot = <code><a href='https://rdrr.io/r/base/logical.html'>TRUE</a></code>; last detected cell are indicates with red circles). Due to smaller fragments of erroneously detected cells, for both search grids a cut-off value is added where the next cell should not be smaller than the lumen area of the target cell (CA_n) times a factor (ec = earlywood cut off and lc = latewood cut off). Finally, a flexible spline is fitted through the selected cells within a row to detect missing cells. Once all cells are detected (last cell is indicated with a red square), the distance between the cells is analysed and depending upon a profile cut-off factor (prof.co) the row is omitted, if the distance difference between n+1 and n+2 times prof.co is bigger than the distance of n and n+1 (which could present a gap often caused by resin ducts; omitted rows are indicated with a "+" symbol). Also, rows that have less cells then the maximum cell count times a factor (max.cells) are removed, as the row might be incomplete (omitted rows are indicated with a "x" symbol).</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='co'>#example of position detection</span>
<span class='no'>input</span><span class='kw'>&lt;-</span><span class='fu'><a href='is.raptor.html'>is.raptor</a></span>(<span class='fu'><a href='example.data.html'>example.data</a></span>(<span class='kw'>species</span><span class='kw'>=</span><span class='st'>"MOUNT_PINUS"</span>), <span class='kw'>str</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)
<span class='no'>aligned</span><span class='kw'>&lt;-</span><span class='fu'><a href='align.html'>align</a></span>(<span class='no'>input</span>, <span class='kw'>list</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"h"</span>, <span class='st'>"h"</span>, <span class='st'>"h"</span>, <span class='fl'>0.03</span>), <span class='kw'>make.plot</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)
<span class='no'>first</span><span class='kw'>&lt;-</span><span class='fu'><a href='first.cell.html'>first.cell</a></span>(<span class='no'>aligned</span>, <span class='kw'>frac.small</span> <span class='kw'>=</span> <span class='fl'>0.2</span>, <span class='kw'>yrs</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>make.plot</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)
<span class='no'>output</span><span class='kw'>&lt;-</span><span class='fu'>pos.det</span>(<span class='no'>first</span>, <span class='kw'>swe</span> <span class='kw'>=</span> <span class='fl'>0.7</span>, <span class='kw'>sle</span> <span class='kw'>=</span> <span class='fl'>3</span>, <span class='kw'>ec</span> <span class='kw'>=</span> <span class='fl'>1.75</span>, <span class='kw'>swl</span> <span class='kw'>=</span> <span class='fl'>0.5</span>, <span class='kw'>sll</span> <span class='kw'>=</span> <span class='fl'>5</span>, <span class='kw'>lc</span> <span class='kw'>=</span> <span class='fl'>10</span>,
                <span class='kw'>prof.co</span> <span class='kw'>=</span> <span class='fl'>1.7</span>, <span class='kw'>max.cells</span> <span class='kw'>=</span> <span class='fl'>0.7</span>, <span class='kw'>yrs</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>aligning</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>make.plot</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)
}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Richard L. Peters, Patrick Fonti.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


